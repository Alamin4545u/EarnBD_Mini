<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Impression Pro</title>
    
    <!-- Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- Monetag SDK -->
    <script src='//libtl.com/sdk.js' data-zone='10197154' data-sdk='show_10197154'></script>

    <style>
        body {
            margin: 0; padding: 0;
            background-color: #0e1621;
            color: #fff;
            font-family: sans-serif;
            display: flex; justify-content: center; align-items: center;
            height: 100vh; text-align: center;
        }
        .container {
            width: 90%; background: #17212b;
            padding: 30px; border-radius: 20px;
            border: 1px solid #2b5278;
        }
        .stat-box {
            display: flex; justify-content: space-around;
            margin-bottom: 20px;
        }
        .stat-item h2 { margin: 0; color: #6ab3f3; }
        .stat-item p { margin: 0; font-size: 12px; color: #8393a3; }
        
        #status { font-weight: bold; color: #0088cc; margin: 15px 0; }
        
        .btn-start {
            background: #0088cc; color: white;
            border: none; padding: 15px 30px;
            border-radius: 50px; font-weight: bold;
            width: 100%; cursor: pointer;
        }
        .btn-start:disabled { background: #4e5e6e; }

        /* পপআপ অ্যাড ক্লোজ করার জন্য জোরপূর্বক সিএসএস */
        #monetag-ad-container { display: none !important; }
    </style>
</head>
<body>

<div class="container">
    <div class="stat-box">
        <div class="stat-item">
            <h2 id="imp-count">0</h2>
            <p>Impressions</p>
        </div>
        <div class="stat-item">
            <h2 id="click-count">0</h2>
            <p>Clicks</p>
        </div>
    </div>

    <div id="status">Ready to Start</div>
    <button id="startBtn" class="btn-start" onclick="startLoop()">Start Auto Impression</button>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    let impressions = 0;
    let clicks = 0;
    let isRunning = false;

    // ক্লিক ট্র্যাকিং
    window.addEventListener('blur', () => {
        if(isRunning) {
            clicks++;
            document.getElementById('click-count').innerText = clicks;
        }
    });

    async function startLoop() {
        if(isRunning) return;
        isRunning = true;
        document.getElementById('startBtn').disabled = true;
        document.getElementById('startBtn').innerText = "Running...";

        while(isRunning) {
            // ১. অ্যাড লোড করা
            updateStatus("Loading Ad...");
            if (typeof show_10197154 === 'function') {
                show_10197154();
                
                // ২. ১৫ সেকেন্ড অ্যাড দেখানো
                let timeLeft = 15;
                while(timeLeft > 0) {
                    updateStatus(`Watching Ad: ${timeLeft}s remaining`);
                    await new Promise(r => setTimeout(r, 1000));
                    timeLeft--;
                }

                // ৩. অটোমেটিক অ্যাড ক্লোজ করা (DOM থেকে রিমুভ করা)
                forceCloseAds();
                impressions++;
                document.getElementById('imp-count').innerText = impressions;

                // ৪. ২ সেকেন্ড বিরতি
                updateStatus("Gap: 2 Seconds...");
                await new Promise(r => setTimeout(r, 2000));
            } else {
                updateStatus("SDK Error! Retrying...");
                await new Promise(r => setTimeout(r, 5000));
            }
        }
    }

    function updateStatus(msg) {
        document.getElementById('status').innerText = msg;
    }

    // এই ফাংশনটি স্ক্রিন থেকে বিজ্ঞাপনের সব এলিমেন্ট ডিলিট করে দেবে
    function forceCloseAds() {
        // Monetag সাধারণত আইফ্রেম বা নির্দিষ্ট ক্লাসের ডিভ দিয়ে অ্যাড দেখায়
        const selectors = [
            'iframe', 
            '[id^="monetag"]', 
            '[class^="monetag"]', 
            '.modal-overlay', 
            '.interstitial-ads'
        ];

        selectors.forEach(selector => {
            const elements = document.querySelectorAll(selector);
            elements.forEach(el => {
                // মেইন বডি বা দরকারি এলিমেন্ট বাদে সব রিমুভ করবে
                if (!el.classList.contains('container')) {
                    el.remove();
                }
            });
        });
        
        // কিছু ক্ষেত্রে বডি স্টাইল লক হয়ে যায়, সেটা আনলক করা
        document.body.style.overflow = 'auto';
        console.log("Ad Force Closed");
    }
</script>

</body>
</html>

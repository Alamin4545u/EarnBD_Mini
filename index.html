<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Auto Reward Every 15s - Premium Monetag TMA</title>
  
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  
  <style>
    :root {
      --tg-bg: #0d1117;
      --tg-text: #c9d1d9;
      --tg-accent: #58a6ff;
      --tg-success: #238636;
      --tg-card: #161b22;
      --tg-border: #30363d;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #0d1117, #0a0e14);
      color: var(--tg-text);
      min-height: 100vh;
      margin: 0;
      display: flex;
      flex-direction: column;
    }
    header {
      background: rgba(13,17,23,0.9);
      backdrop-filter: blur(10px);
      padding: 16px;
      text-align: center;
      position: sticky;
      top: 0;
      z-index: 100;
      border-bottom: 1px solid var(--tg-border);
    }
    h1 { font-size: 1.9rem; color: white; margin: 0 0 8px; }
    .balance { font-size: 1.5rem; font-weight: bold; color: #ffd700; }
    .container { flex: 1; padding: 20px 16px; max-width: 420px; margin: 0 auto; width: 100%; }
    .card {
      background: var(--tg-card);
      border: 1px solid var(--tg-border);
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.6);
    }
    .btn {
      background: linear-gradient(135deg, var(--tg-success), #2ea043);
      color: white;
      border: none;
      padding: 16px;
      font-size: 1.2rem;
      font-weight: bold;
      border-radius: 12px;
      width: 100%;
      margin: 12px 0;
      cursor: pointer;
      transition: all 0.3s;
    }
    .btn:hover { transform: scale(1.04); }
    .btn:disabled { background: #444; cursor: not-allowed; }
    #status {
      text-align: center;
      margin: 20px 0;
      padding: 12px;
      border-radius: 10px;
      font-size: 1.1rem;
      background: rgba(88,166,255,0.15);
    }
    .success { background: rgba(35,134,54,0.2); color: #7fff7f; }
    .warning { background: rgba(255,165,0,0.2); color: #ffcc00; }
    .countdown { font-size: 1.3rem; font-weight: bold; color: #ff9500; margin: 10px 0; }
    .loader {
      border: 5px solid #333;
      border-top: 5px solid var(--tg-accent);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
      display: none;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>

  <header>
    <h1>Auto Reward Mode</h1>
    <div class="balance">Coins: <span id="coins">0</span></div>
  </header>

  <div class="container">
    <div class="card">
      <h2>Auto Ads Every 15 Seconds</h2>
      <p>Watch rewarded ads automatically — earn coins non-stop! (High CPM format)</p>
      
      <div id="status">Starting auto mode in few seconds...</div>
      <div class="countdown" id="countdown">Next ad in: 15s</div>
      <div class="loader" id="loader"></div>

      <button class="btn" id="toggleAuto">Pause Auto Ads</button>
      <button class="btn" style="background:#444;" onclick="Telegram.WebApp.close()">Exit</button>
    </div>
  </div>

  <script>
    // === আপনার Monetag Rewarded Tag ID ===
    const REWARDED_ID = "10197154"; // ← real ID দিন (show_10197154)
    const AD_INTERVAL = 15000; // 15 seconds
    const MIN_COOLDOWN = 5000; // 5s extra cooldown after ad

    window.Telegram.WebApp.ready();
    window.Telegram.WebApp.expand();

    let coins = parseInt(localStorage.getItem("coins") || "0");
    document.getElementById("coins").textContent = coins;

    let autoEnabled = true;
    let isAdShowing = false;
    let timer = null;
    let countdownInterval = null;

    const status = document.getElementById("status");
    const countdownEl = document.getElementById("countdown");
    const loader = document.getElementById("loader");
    const toggleBtn = document.getElementById("toggleAuto");

    function updateCoins(amount) {
      coins += amount;
      document.getElementById("coins").textContent = coins;
      localStorage.setItem("coins", coins);
    }

    function startCountdown() {
      let timeLeft = AD_INTERVAL / 1000;
      countdownEl.textContent = `Next ad in: ${timeLeft}s`;
      countdownInterval = setInterval(() => {
        timeLeft--;
        countdownEl.textContent = `Next ad in: ${timeLeft}s`;
        if (timeLeft <= 0) clearInterval(countdownInterval);
      }, 1000);
    }

    function showRewardedAd() {
      if (!autoEnabled || isAdShowing) return;
      isAdShowing = true;
      loader.style.display = "block";
      status.textContent = "Showing rewarded ad...";
      status.className = "";

      const adFunc = window[`show_${REWARDED_ID}`];
      if (typeof adFunc === "function") {
        adFunc()
          .then(() => {
            updateCoins(150); // Adjust reward amount
            status.textContent = "Ad watched! +150 coins ✓";
            status.className = "success";
          })
          .catch(err => {
            status.textContent = "Ad skipped/failed — retrying soon";
            status.className = "warning";
            console.log("Ad error:", err);
          })
          .finally(() => {
            loader.style.display = "none";
            isAdShowing = false;
            setTimeout(startAutoTimer, MIN_COOLDOWN);
          });
      } else {
        status.textContent = "Ad function not ready — check SDK";
        status.className = "warning";
        isAdShowing = false;
        setTimeout(startAutoTimer, 5000);
      }
    }

    function startAutoTimer() {
      if (!autoEnabled) return;
      clearTimeout(timer);
      clearInterval(countdownInterval);
      startCountdown();
      timer = setTimeout(showRewardedAd, AD_INTERVAL);
    }

    toggleBtn.onclick = () => {
      autoEnabled = !autoEnabled;
      toggleBtn.textContent = autoEnabled ? "Pause Auto Ads" : "Resume Auto Ads";
      status.textContent = autoEnabled ? "Auto mode resumed" : "Auto mode paused";
      status.className = autoEnabled ? "success" : "";
      if (autoEnabled) startAutoTimer();
      else clearTimeout(timer);
    };

    // Start on load
    setTimeout(() => {
      if (typeof window[`show_${REWARDED_ID}`] === "function") {
        status.textContent = "Auto rewarded ads active (every 15s)";
        startAutoTimer();
      } else {
        status.textContent = "Waiting for Monetag SDK...";
      }
    }, 3000);
  </script>
</body>
</html>
